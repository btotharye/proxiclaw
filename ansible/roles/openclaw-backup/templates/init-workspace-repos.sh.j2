#!/bin/bash
# Initialize Git Repositories for OpenClaw Workspace Projects
# Automatically generated by Ansible

WORKSPACE_DIR="/home/{{ ansible_user }}/.openclaw/workspace"

if [ ! -d "$WORKSPACE_DIR" ]; then
    echo "Error: OpenClaw workspace directory not found: $WORKSPACE_DIR"
    exit 1
fi

echo "Scanning OpenClaw workspace for projects..."
echo

# Find all directories in workspace (excluding hidden dirs)
for project_dir in "$WORKSPACE_DIR"/*; do
    if [ ! -d "$project_dir" ]; then
        continue
    fi
    
    project_name=$(basename "$project_dir")
    
    # Skip if already a git repo
    if [ -d "$project_dir/.git" ]; then
        echo "✓ $project_name - already a git repository"
        continue
    fi
    
    # Check if directory has actual content (not empty)
    if [ -z "$(ls -A "$project_dir" 2>/dev/null)" ]; then
        echo "⊘ $project_name - empty directory, skipping"
        continue
    fi
    
    echo "→ $project_name - initializing git repository..."
    
    cd "$project_dir"
    
    # Initialize git
    git init
    
    # Create .gitignore if it doesn't exist
    if [ ! -f .gitignore ]; then
        cat > .gitignore <<'EOF'
# Dependencies
node_modules/
venv/
__pycache__/
*.pyc

# Environment variables
.env
.env.local
*.secret

# Build outputs
dist/
build/
*.egg-info/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
*.log
logs/
EOF
        echo "  ✓ Created .gitignore"
    fi
    
    # Create README if it doesn't exist
    if [ ! -f README.md ]; then
        cat > README.md <<EOF
# $project_name

Created via OpenClaw workspace.

## Setup

\`\`\`bash
# Add your setup instructions here
\`\`\`

## Usage

\`\`\`bash
# Add usage examples here
\`\`\`
EOF
        echo "  ✓ Created README.md"
    fi
    
    # Initial commit
    git add .
    git commit -m "Initial commit from OpenClaw workspace" -q
    echo "  ✓ Created initial commit"
    
    echo "  → To push to GitHub:"
    echo "     cd $project_dir"
    echo "     git remote add origin git@github.com:yourusername/$project_name.git"
    echo "     git push -u origin main"
    echo
done

echo
echo "Done! All workspace projects initialized."
echo
echo "Next steps:"
echo "1. Create GitHub repos for your projects"
echo "2. Add remotes: git remote add origin git@github.com:username/repo.git"
echo "3. Push: git push -u origin main"
echo
echo "Your .cursorrules files are included and will be versioned with each project!"
